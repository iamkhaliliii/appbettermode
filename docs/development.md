 # راهنمای توسعه

این سند، روند توسعه پروژه و نحوه کار با آن را توضیح می‌دهد.

## پیش‌نیازها

- Node.js نسخه 18 یا بالاتر
- npm یا yarn
- پایگاه داده PostgreSQL

## راه‌اندازی محیط توسعه

1. نصب وابستگی‌ها:

```bash
npm install
```

2. ساخت فایل `.env` با محتوای زیر:

```
NODE_ENV=development
DATABASE_URL=postgresql://username:password@localhost:5432/dbname
PORT=4000
```

3. اجرای برنامه در حالت توسعه:

```bash
npm run dev
```

4. دسترسی به برنامه:
   - فرانت‌اند: http://localhost:4000
   - API: http://localhost:4000/api/v1

## ساختار دایرکتوری

```
App-bettermode/
├── api/                    # فایل‌های JavaScript کامپایل شده برای Vercel
├── client/                 # کد فرانت‌اند
│   └── src/
│       ├── components/     # کامپوننت‌های React
│       ├── hooks/          # هوک‌های سفارشی
│       ├── lib/            # توابع کمکی و کلاینت API
│       ├── pages/          # صفحات برنامه
│       └── types/          # تعاریف TypeScript
├── docs/                   # مستندات
├── scripts/                # اسکریپت‌های کمکی
├── server/                 # کد بک‌اند
│   ├── db/                 # اتصال به پایگاه داده و مدل‌ها
│   ├── routes/             # مسیرهای API
│   └── utils/              # توابع کمکی
├── package.json            # وابستگی‌ها و اسکریپت‌ها
└── vercel.json             # پیکربندی Vercel
```

## فرآیند کار

### توسعه محلی

1. از شاخه `main` یک شاخه جدید بسازید
2. تغییرات خود را انجام دهید
3. با اجرای `npm run dev` برنامه را در حالت محلی تست کنید
4. تغییرات را کامیت کنید

### استقرار در Vercel

1. از `npm run build` برای ساخت نسخه نهایی استفاده کنید
2. مطمئن شوید که تمام فایل‌های مورد نیاز در پوشه `api` وجود دارند
3. تغییرات را به `main` مرج کنید
4. Vercel به صورت خودکار برنامه را مستقر می‌کند

## توصیه‌های کدنویسی

1. از TypeScript برای تمام کدهای جدید استفاده کنید
2. از Zod برای اعتبارسنجی داده‌ها استفاده کنید
3. برای هر API جدید، ابتدا اجزای مورد نیاز را در سرور ایجاد کنید، سپس کد کلاینت را بنویسید
4. تمام تغییرات در `server` را انجام دهید، نه در `api`
5. از `try/catch` برای مدیریت خطاها استفاده کنید

## دیباگ کردن

### دیباگ سرور

برای لاگ گرفتن در سرور، از کد زیر استفاده کنید:

```typescript
import { logger } from '../utils/logger.js';

logger.info('پیام لاگ');
logger.error('پیام خطا', error);
```

### دیباگ API در Vercel

برای لاگ گرفتن در توابع Vercel، از `console.log` استفاده کنید و لاگ‌ها را در پنل Vercel مشاهده کنید:

```javascript
console.log('[VERCEL_API] پیام لاگ', data);
```

## تست‌ها

در حال حاضر، تست‌های اتوماتیک پیاده‌سازی نشده‌اند. برای تست‌های دستی، از ابزارهایی مانند Postman یا Thunder Client استفاده کنید.